box: node:10.16-alpine

build:
  steps:
    - bashaus/yarn-install:
      name: install-dependencies

    - script:
      name: style-guide-check
      code: yarn lint

    - script:
      name: unit-test
      code: yarn test:unit

    - script:
      name: cleanup
      code: |
        rm -rf ./node_modules

deploy:
  box:
    id: arcanebet/frontend
    username: $DOCKERHUB_USERNAME
    password: $DOCKERHUB_PASSWORD
    tag: puppeteer-v10

  steps:
    - bashaus/yarn-install:
      name: install-dependencies

    - script:
      name: build-production-assets
      code: yarn build

    - script:
      name: deploy
      code: |
        echo $AWS_ACCESS_KEY_ID
        echo $AWS_SECRET_ACCESS_KEY
        yarn deploy
